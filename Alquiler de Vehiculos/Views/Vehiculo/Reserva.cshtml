@{
    ViewData["Title"] = "Reserva";
}

<h1>Reservas</h1>

<div class="card text-center mb-4">
    <div class="card-header">
        <ul class="nav nav-tabs card-header-tabs" id="reservaTabs" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" 
                        id="reservar-tab" 
                        data-bs-toggle="tab" 
                        data-bs-target="#reservar" 
                        type="button" 
                        role="tab" 
                        aria-controls="reservar" 
                        aria-selected="true">
                    <i class="fas fa-calendar-plus me-2"></i>
                    Reservar
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link " 
                        id="misreservas-tab" 
                        data-bs-toggle="tab" 
                        data-bs-target="#misreservas" 
                        type="button" 
                        role="tab" 
                        aria-controls="misreservas" 
                        aria-selected="false">
                    <i class="fas fa-list-alt me-2"></i>
                    Mis Reservaciones
                </button>
            </li>

            <!--ESTA PESTAÑA ES SOLO PARA LOS EMPLEADOS DONDE APRUEBA O NO LOS ALQUILERES-->
            <li class="nav-item" role="presentation">
                <button class="nav-link" 
                        id="solicitudes-tab" 
                        data-bs-toggle="tab" 
                        data-bs-target="#solicitudes" 
                        type="button" 
                        role="tab" 
                        aria-controls="solicitudes" 
                        aria-selected="false">
                    <i class="fas fa-tasks me-2"></i>
                    Solicitudes Pendientes
                </button>
            </li>
        </ul>
    </div>
    <div class="card-body">
        <div class="tab-content" id="reservaTabsContent">
            <!-- Pestaña de Reservar -->
            <div class="tab-pane fade show active" id="reservar" role="tabpanel" aria-labelledby="reservar-tab">
                <!--Contenedor principal-->
                <div class="container">
                    <!--Sección de selección de vehículo-->
                    <div class="card shadow-lg border-0 rounded-lg mb-4">
                        <div class="card-header bg-gradient text-white" style="background-color:#FAB12F;">
                            <h4 class="mb-0">
                                <i class="fas fa-car me-2"></i>
                                Selección de Vehículo
                            </h4>
                        </div>
                        <div class="card-body">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th scope="col">#</th>
                                        <th scope="col">Modelo</th>
                                        <th scope="col">Año</th>
                                        <th scope="col">Precio/Día</th>
                                        <th scope="col">Acción</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- Aquí va el contenido de la tabla -->
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!--Sección de fechas-->
                    <div class="card shadow-lg border-0 rounded-lg mb-4">
                        <div class="card-header bg-gradient text-white" style="background-color: #FA812F;">
                            <h4 class="mb-0">
                                <i class="fas fa-calendar-check me-2"></i>
                                Selecciona las Fechas de tu Reserva
                            </h4>
                        </div>
                        <div class="card-body p-4">
                            <form id="fechasReservaForm">
                                <div class="row g-4">
                                    <div class="col-md-6">
                                        <div class="form-floating">
                                            <input type="date"
                                                class="form-control form-control-lg"
                                                id="fechaInicio"
                                                name="fechaInicio"
                                                required
                                                min="@DateTime.Now.ToString("yyyy-MM-dd")"
                                                placeholder="Fecha de Inicio">
                                            <label for="fechaInicio">
                                                <i class="fas fa-calendar-alt text-primary me-2"></i>
                                                Fecha de Inicio
                                            </label>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-floating">
                                            <input type="date"
                                                class="form-control form-control-lg"
                                                id="fechaFin"
                                                name="fechaFin"
                                                required
                                                min="@DateTime.Now.AddDays(1).ToString("yyyy-MM-dd")"
                                                placeholder="Fecha de Devolución">
                                            <label for="fechaFin">
                                                <i class="fas fa-calendar-check text-primary me-2"></i>
                                                Fecha de Devolución
                                            </label>
                                        </div>
                                    </div>
                                    <div class="col-12">
                                        <div class="d-flex justify-content-between align-items-center mt-4">
                                            <span class="text-muted">
                                                <i class="fas fa-info-circle me-2"></i>
                                                Selecciona las fechas para calcular el precio total
                                            </span>
                                        </div>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>

                    <!--Sección de método de pago-->
                    <div class="card shadow-lg border-0 rounded-lg mb-4">
                        <div class="card-header bg-gradient text-white" style="background-color:#28a745;">
                            <h4 class="mb-0">
                                <i class="fas fa-money-check-alt me-2"></i>
                                Seleccione el Método de Pago
                            </h4>
                        </div>
                        <div class="card-body p-4">
                            <div class="row mb-4">
                                <div class="col-12">
                                    <div class="btn-group w-100" role="group">
                                        <input type="radio" class="btn-check" name="metodoPago" id="efectivo" autocomplete="off" checked>
                                        <label class="btn btn-outline-primary" for="efectivo">
                                            <i class="fas fa-money-bill-wave me-2"></i>
                                            Efectivo
                                        </label>

                                        <input type="radio" class="btn-check" name="metodoPago" id="transferencia" autocomplete="off">
                                        <label class="btn btn-outline-primary" for="transferencia">
                                            <i class="fas fa-university me-2"></i>
                                            Transferencia
                                        </label>

                                        <input type="radio" class="btn-check" name="metodoPago" id="tarjeta" autocomplete="off">
                                        <label class="btn btn-outline-primary" for="tarjeta">
                                            <i class="fas fa-credit-card me-2"></i>
                                            Tarjeta
                                        </label>
                                    </div>
                                </div>
                            </div>

                            <!-- Opción Efectivo -->
                            <div id="efectivoContent" class="payment-content">
                                <div class="alert alert-info" role="alert">
                                    <h5 class="alert-heading">
                                        <i class="fas fa-info-circle me-2"></i>
                                        Pago en Efectivo
                                    </h5>
                                    <hr>
                                    <p class="mb-0">Número de Orden: <strong id="ordenNumber"></strong></p>
                                    <p>Presente este número en nuestra agencia para realizar el pago.</p>
                                    <p class="mb-0">La reserva será confirmada una vez se realice el pago.</p>
                                </div>
                            </div>

                            <!-- Opción Transferencia -->
                            <div id="transferenciaContent" class="payment-content d-none">
                                <div class="row g-4">
                                    <div class="col-md-4">
                                        <div class="card h-100 border-primary">
                                            <div class="card-header">
                                                <h5 class="mb-0">Banco Pichincha</h5>
                                            </div>
                                            <div class="card-body">
                                                <p class="card-text">
                                                    <strong>Cuenta Corriente:</strong><br>
                                                    2203456789<br>
                                                    <strong>Titular:</strong><br>
                                                    Car Express S.A.<br>
                                                    <strong>RUC:</strong><br>
                                                    1234567890001
                                                </p>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="card h-100 border-success">
                                            <div class="card-header">
                                                <h5 class="mb-0">Banco Guayaquil</h5>
                                            </div>
                                            <div class="card-body">
                                                <p class="card-text">
                                                    <strong>Cuenta Ahorros:</strong><br>
                                                    4567890123<br>
                                                    <strong>Titular:</strong><br>
                                                    Car Express S.A.<br>
                                                    <strong>RUC:</strong><br>
                                                    1234567890001
                                                </p>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="card h-100 border-info">
                                            <div class="card-header">
                                                <h5 class="mb-0">Banco Produbanco</h5>
                                            </div>
                                            <div class="card-body">
                                                <p class="card-text">
                                                    <strong>Cuenta Corriente:</strong><br>
                                                    7890123456<br>
                                                    <strong>Titular:</strong><br>
                                                    Car Express S.A.<br>
                                                    <strong>RUC:</strong><br>
                                                    1234567890001
                                                </p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="alert alert-warning mt-4" role="alert">
                                    <i class="fas fa-exclamation-triangle me-2"></i>
                                    Una vez realizada la transferencia, por favor enviar el comprobante al correo: pagos@carexpress.com
                                </div>
                            </div>

                            <!-- Opción Tarjeta -->
                            <div id="tarjetaContent" class="payment-content d-none">
                                <!-- Aquí va el formulario de tarjeta existente -->
                                <form class="row g-3 needs-validation" novalidate>
                                    <div class="col-md-6">
                                        <div class="form-floating mb-3">
                                            <input type="text" class="form-control" id="nombreTarjeta" required
                                                placeholder="Nombre en la tarjeta">
                                            <label for="nombreTarjeta">
                                                <i class="fas fa-user me-2"></i>
                                                Nombre en la tarjeta
                                            </label>
                                            <div class="invalid-feedback">
                                                Por favor ingrese el nombre que aparece en la tarjeta.
                                            </div>
                                        </div>
                                    </div>

                                    <div class="col-md-6">
                                        <div class="form-floating mb-3">
                                            <input type="text" class="form-control" id="numeroTarjeta" required
                                                pattern="[0-9]{16}" placeholder="Número de tarjeta">
                                            <label for="numeroTarjeta">
                                                <i class="fas fa-credit-card me-2"></i>
                                                Número de tarjeta
                                            </label>
                                            <div class="invalid-feedback">
                                                Por favor ingrese un número de tarjeta válido (16 dígitos).
                                            </div>
                                        </div>
                                    </div>

                                    <div class="col-md-4">
                                        <div class="form-floating mb-3">
                                            <input type="text" class="form-control" id="fechaExpiracion" required
                                                pattern="(0[1-9]|1[0-2])\/([0-9]{2})" placeholder="MM/YY">
                                            <label for="fechaExpiracion">
                                                <i class="fas fa-calendar-alt me-2"></i>
                                                Fecha de expiración (MM/YY)
                                            </label>
                                            <div class="invalid-feedback">
                                                Por favor ingrese una fecha válida (MM/YY).
                                            </div>
                                        </div>
                                    </div>

                                    <div class="col-md-4">
                                        <div class="form-floating mb-3">
                                            <input type="text" class="form-control" id="cvv" required
                                                pattern="[0-9]{3,4}" placeholder="CVV">
                                            <label for="cvv">
                                                <i class="fas fa-lock me-2"></i>
                                                CVV
                                            </label>
                                            <div class="invalid-feedback">
                                                Por favor ingrese un CVV válido.
                                            </div>
                                        </div>
                                    </div>

                                    <div class="col-md-4">
                                        <div class="form-floating mb-3">
                                            <select class="form-select" id="tipoTarjeta" required>
                                                <option value="" disabled selected>Seleccione...</option>
                                                <option value="visa">Visa</option>
                                                <option value="mastercard">Mastercard</option>
                                                <option value="amex">American Express</option>
                                            </select>
                                            <label for="tipoTarjeta">
                                                <i class="fas fa-credit-card me-2"></i>
                                                Tipo de tarjeta
                                            </label>
                                            <div class="invalid-feedback">
                                                Por favor seleccione un tipo de tarjeta.
                                            </div>
                                        </div>
                                    </div>

                                    <div class="col-12">
                                        <div class="form-check mb-3">
                                            <input class="form-check-input" type="checkbox" id="terminos" required>
                                            <label class="form-check-label" for="terminos">
                                                Acepto los términos y condiciones del servicio
                                            </label>
                                            <div class="invalid-feedback">
                                                Debe aceptar los términos y condiciones para continuar.
                                            </div>
                                        </div>
                                    </div>

                                    <div class="col-12">
                                        <button class="btn btn-primary btn-lg w-100" type="submit">
                                            <i class="fas fa-lock me-2"></i>
                                            Confirmar Pago
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>

                    <!--Botón de confirmación final-->
                    <div class="d-grid gap-2 col-6 mx-auto mb-4">
                        <button class="btn btn-success btn-lg" type="button" id="btnConfirmarReserva">
                            <i class="fas fa-check-circle me-2"></i>
                            Confirmar Reserva
                        </button>
                    </div>
                </div>
            </div>

            <!-- Pestaña de Mis Reservaciones -->
            <div class="tab-pane fade" id="misreservas" role="tabpanel" aria-labelledby="misreservas-tab">
                <div class="container">
                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead class="table-dark">
                                <tr>
                                    <th>Nº Reserva</th>
                                    <th>Vehículo</th>
                                    <th>Fecha Inicio</th>
                                    <th>Fecha Fin</th>
                                    <th>Estado</th>
                                    <th>Total</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Aquí irán las reservas del usuario -->
                                <tr>
                                    <td>RES-001</td>
                                    <td>Toyota Corolla 2024</td>
                                    <td>01/03/2024</td>
                                    <td>05/03/2024</td>
                                    <td><span class="badge bg-success">Confirmada</span></td>
                                    <td>$250.00</td>
                                    <td>
                                <!--Aqui si es que sigue pendiente se puede eliminar o editar pero si ya es confirmada no-->
<button class="btn btn-sm btn-warning" title="Editar">
    <i class="fas fa-edit"></i>
</button>
<button class="btn btn-sm btn-danger" title="Eliminar">
    <i class="fas fa-trash"></i>
</button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Pestaña de Solicitudes Pendientes -->
            <div class="tab-pane fade" id="solicitudes" role="tabpanel" aria-labelledby="solicitudes-tab">
                <div class="container">
                    <div class="card shadow-lg border-0 rounded-lg mb-4">
                        <div class="card-header bg-gradient text-white" style="background-color: #6c757d;">
                            <h4 class="mb-0">
                                <i class="fas fa-clipboard-check me-2"></i>
                                Gestión de Solicitudes
                            </h4>
                        </div>
                        <div class="card-body">
                            <!-- Filtros -->
                            <div class="row mb-4">
                                <div class="col-md-4">
                                    <div class="form-floating">
                                        <select class="form-select" id="filtroEstado">
                                            <option value="">Todos</option>
                                            <option value="pendiente">Pendientes</option>
                                            <option value="aprobada">Aprobadas</option>
                                            <option value="rechazada">Rechazadas</option>
                                        </select>
                                        <label><i class="fas fa-filter me-2"></i>Filtrar por Estado</label>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-floating">
                                        <input type="date" class="form-control" id="filtroFecha">
                                        <label><i class="fas fa-calendar me-2"></i>Filtrar por Fecha</label>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-floating">
                                        <input type="text" class="form-control" id="filtroCliente" placeholder="Buscar cliente">
                                        <label><i class="fas fa-search me-2"></i>Buscar Cliente</label>
                                    </div>
                                </div>
                            </div>

                            <!-- Tabla de solicitudes -->
                            <div class="table-responsive">
                                <table class="table table-hover">
                                    <thead class="table-dark">
                                        <tr>
                                            <th>ID Solicitud</th>
                                            <th>Cliente</th>
                                            <th>Vehículo</th>
                                            <th>Fecha Inicio</th>
                                            <th>Fecha Fin</th>
                                            <th>Método Pago</th>
                                            <th>Estado</th>
                                            <th>Acciones</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td>SOL-001</td>
                                            <td>Juan Pérez</td>
                                            <td>Toyota Corolla 2024</td>
                                            <td>01/03/2024</td>
                                            <td>05/03/2024</td>
                                            <td>Efectivo</td>
                                            <td><span class="badge bg-warning">Pendiente</span></td>
                                            <td> 
                                                <button class="btn btn-sm btn-info" title="Ver Detalles" data-bs-toggle="modal" data-bs-target="#detallesSolicitudModal">
                                                    <i class="fas fa-eye"></i>
                                                </button>
                                            </td>
                                        </tr>
                                        <!-- Más filas de ejemplo... -->
                                    </tbody>
                                </table>
                            </div>

                            <!-- Modal de Detalles -->
                            <div class="modal fade" id="detallesSolicitudModal" tabindex="-1">
                                <div class="modal-dialog modal-lg">
                                    <div class="modal-content">
                                        <div class="modal-header">
                                            <h5 class="modal-title">Detalles de la Solicitud</h5>
                                            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                                        </div>
                                        <div class="modal-body">
                                            <div class="row">
                                                <div class="col-md-6">
                                                    <h6>Información del Cliente</h6>
                                                    <p><strong>Nombre:</strong> Juan Pérez</p>
                                                    <p><strong>Email:</strong> juan@email.com</p>
                                                    <p><strong>Teléfono:</strong> 099-999-9999</p>
                                                </div>
                                                <div class="col-md-6">
                                                    <h6>Detalles de la Reserva</h6>
                                                    <p><strong>Vehículo:</strong> Toyota Corolla 2024</p>
                                                    <p><strong>Período:</strong> 01/03/2024 - 05/03/2024</p>
                                                    <p><strong>Total:</strong> $250.00</p>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="modal-footer">
                                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
                                            <button type="button" class="btn btn-success">Aprobar</button>
                                            <button type="button" class="btn btn-danger">Rechazar</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const fechaInicio = document.getElementById('fechaInicio');
            const fechaFin = document.getElementById('fechaFin');

            fechaInicio.addEventListener('change', function() {
                const fechaInicioValue = new Date(this.value);
                const fechaMinFin = new Date(fechaInicioValue);
                fechaMinFin.setDate(fechaInicioValue.getDate() + 1);
                fechaFin.min = fechaMinFin.toISOString().split('T')[0];

                if (new Date(fechaFin.value) <= fechaInicioValue) {
                    fechaFin.value = fechaMinFin.toISOString().split('T')[0];
                }
            });

            // Mostrar número de orden aleatorio
            document.getElementById('ordenNumber').textContent = generateOrderNumber();

            // Gestionar cambios en método de pago
            const metodoPago = document.getElementsByName('metodoPago');
            const contenidos = document.getElementsByClassName('payment-content');

            metodoPago.forEach(radio => {
                radio.addEventListener('change', function() {
                    Array.from(contenidos).forEach(content => {
                        content.classList.add('d-none');
                    });

                    const selectedContent = document.getElementById(this.id + 'Content');
                    if (selectedContent) {
                        selectedContent.classList.remove('d-none');
                    }
                });
            });
        });

        // Generar número de orden aleatorio
        function generateOrderNumber() {
            //return 'ORD-' + Math.random().toString(36).substr(2,9).toUpperCase();
            return 1;
        }

        // Agregar al final de la sección Scripts
        document.getElementById('filtroEstado')?.addEventListener('change', function() {
            // Lógica para filtrar por estado
        });

        document.getElementById('filtroFecha')?.addEventListener('change', function() {
            // Lógica para filtrar por fecha
        });

        document.getElementById('filtroCliente')?.addEventListener('input', function() {
            // Lógica para buscar por cliente
        });
    </script>
    <script>
        // Validación del formulario
        (function () {
            'use strict'
            var forms = document.querySelectorAll('.needs-validation')
            Array.prototype.slice.call(forms)
                .forEach(function (form) {
                    form.addEventListener('submit', function (event) {
                        if (!form.checkValidity()) {
                            event.preventDefault()
                            event.stopPropagation()
                        }
                        form.classList.add('was-validated')
                    }, false)
                })
        })()
    </script>
}

@section Styles {
    <link rel="stylesheet" href="~/css/reserva.css" />
}